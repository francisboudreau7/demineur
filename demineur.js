// Ensemble d'images de taille 16x16 pixels.  Chaque element du
// tableau images correspond a une image d'une tuile du jeu demineur.
// Une image est representee par un tableau des rangees de pixels.
// Chaque rangee est un tableau contenant l'index de la couleur dans
// le tableau colormap.

var images =
    [
     [ // 0
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 1
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
      [8,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
      [8,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 2
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0],
      [8,0,0,2,2,2,2,2,2,2,2,2,2,0,0,0],
      [8,0,0,2,2,2,0,0,0,0,2,2,2,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0],
      [8,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0],
      [8,0,0,0,0,0,2,2,2,2,2,0,0,0,0,0],
      [8,0,0,0,2,2,2,2,2,0,0,0,0,0,0,0],
      [8,0,0,2,2,2,2,0,0,0,0,0,0,0,0,0],
      [8,0,0,2,2,2,2,2,2,2,2,2,2,0,0,0],
      [8,0,0,2,2,2,2,2,2,2,2,2,2,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 3
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0],
      [8,0,0,3,3,3,3,3,3,3,3,3,3,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0],
      [8,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0],
      [8,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0],
      [8,0,0,3,3,3,3,3,3,3,3,3,3,0,0,0],
      [8,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 4
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,4,4,4,0,4,4,4,0,0,0,0],
      [8,0,0,0,0,4,4,4,0,4,4,4,0,0,0,0],
      [8,0,0,0,4,4,4,0,0,4,4,4,0,0,0,0],
      [8,0,0,0,4,4,4,0,0,4,4,4,0,0,0,0],
      [8,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0],
      [8,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0],
      [8,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 5
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,5,5,5,5,5,5,5,5,5,5,0,0,0],
      [8,0,0,5,5,5,5,5,5,5,5,5,5,0,0,0],
      [8,0,0,5,5,5,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,5,5,5,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,5,5,5,5,5,5,5,5,5,0,0,0,0],
      [8,0,0,5,5,5,5,5,5,5,5,5,5,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,5,5,5,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,5,5,5,0,0,0],
      [8,0,0,5,5,5,5,5,5,5,5,5,5,0,0,0],
      [8,0,0,5,5,5,5,5,5,5,5,5,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 6
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
      [8,0,0,6,6,6,6,6,6,6,6,6,0,0,0,0],
      [8,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,6,6,6,6,6,6,6,6,6,0,0,0,0],
      [8,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
      [8,0,0,6,6,6,0,0,0,0,6,6,6,0,0,0],
      [8,0,0,6,6,6,0,0,0,0,6,6,6,0,0,0],
      [8,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
      [8,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 7
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,7,7,7,7,7,7,7,7,7,7,0,0,0],
      [8,0,0,7,7,7,7,7,7,7,7,7,7,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,7,7,7,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,7,7,7,0,0,0],
      [8,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0],
      [8,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0],
      [8,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // 8
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
      [8,0,0,8,8,8,8,8,8,8,8,8,8,0,0,0],
      [8,0,0,8,8,8,0,0,0,0,8,8,8,0,0,0],
      [8,0,0,8,8,8,0,0,0,0,8,8,8,0,0,0],
      [8,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
      [8,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
      [8,0,0,8,8,8,0,0,0,0,8,8,8,0,0,0],
      [8,0,0,8,8,8,0,0,0,0,8,8,8,0,0,0],
      [8,0,0,8,8,8,8,8,8,8,8,8,8,0,0,0],
      [8,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // mine
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0],
      [8,0,0,0,7,0,7,7,7,7,7,0,7,0,0,0],
      [8,0,0,0,0,7,7,7,7,7,7,7,0,0,0,0],
      [8,0,0,0,7,7,9,9,7,7,7,7,7,0,0,0],
      [8,0,0,0,7,7,9,9,7,7,7,7,7,0,0,0],
      [8,0,7,7,7,7,7,7,7,7,7,7,7,7,7,0],
      [8,0,0,0,7,7,7,7,7,7,7,7,7,0,0,0],
      [8,0,0,0,7,7,7,7,7,7,7,7,7,0,0,0],
      [8,0,0,0,0,7,7,7,7,7,7,7,0,0,0,0],
      [8,0,0,0,7,0,7,7,7,7,7,0,7,0,0,0],
      [8,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0],
      [8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
     ],
     [ // mine sur fond rouge
      [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [8,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],
      [8,3,3,3,3,3,3,3,7,3,3,3,3,3,3,3],
      [8,3,3,3,3,3,3,3,7,3,3,3,3,3,3,3],
      [8,3,3,3,7,3,7,7,7,7,7,3,7,3,3,3],
      [8,3,3,3,3,7,7,7,7,7,7,7,3,3,3,3],
      [8,3,3,3,7,7,9,9,7,7,7,7,7,3,3,3],
      [8,3,3,3,7,7,9,9,7,7,7,7,7,3,3,3],
      [8,3,7,7,7,7,7,7,7,7,7,7,7,7,7,3],
      [8,3,3,3,7,7,7,7,7,7,7,7,7,3,3,3],
      [8,3,3,3,7,7,7,7,7,7,7,7,7,3,3,3],
      [8,3,3,3,3,7,7,7,7,7,7,7,3,3,3,3],
      [8,3,3,3,7,3,7,7,7,7,7,3,7,3,3,3],
      [8,3,3,3,3,3,3,3,7,3,3,3,3,3,3,3],
      [8,3,3,3,3,3,3,3,7,3,3,3,3,3,3,3],
      [8,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]
     ],
     [ // tuile non-devoilee
      [9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0],
      [9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,9,0,0,0,0,0,0,0,0,0,0,0,0,8,8],
      [9,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
      [0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8]
     ]
    ];

// Ensemble de couleurs utilisees dans la definition des images
// ci-dessus.  A tout endroit ou le nombre c apparait dans une image,
// la couleur RGB du pixel est colormap[c].

var colormap =
    [
     { r: 192, g: 192, b: 192 },
     { r:   0, g:   0, b: 255 },
     { r:   0, g: 128, b:   0 },
     { r: 255, g:   0, b:   0 },
     { r:   0, g:   0, b: 128 },
     { r: 128, g:   0, b:   0 },
     { r:   0, g: 128, b: 128 },
     { r:   0, g:   0, b:   0 },
     { r: 128, g: 128, b: 128 },
     { r: 255, g: 255, b: 255 }
    ];

// INF1015 -TP1-Démineur
//Auteurs: Francis Boudreau et Laura Bégin
//2018-11-05

var afficherImage = function (x, y, colormap, image) {
var hauteur=image.length;
var largeur=image[1].length;
for(var i=0;i<=hauteur-1;i++){

    for(var j=0;j<=largeur-1;j++){
    setPixel(x+i,y+j,colormap[image[j][i]]);
    }
}
};
var attendreClic = function () {

    do {
        var souris = getMouse();
        pause(0.01);
    } while (souris.down == false);
    var tuile=[Math.floor(souris.x/images[1].length), Math.floor(souris.y/images[1][1].length)];
    return (tuile);

};
var placerMines = function (largeur,hauteur,nbMines, x, y) {
    var i,j;
    var mines= Array(largeur);
    
    for (var i=0;i<largeur;i++){
        mines[i]= Array(hauteur);
    }
    
    for(var i=0;i<largeur;i++){
        for(var j=0;j<hauteur;j++){
        mines[i][j]=false;
        }
    }
while(nbMines>0){
i=Math.floor(Math.random()*largeur);
j=Math.floor(Math.random()*hauteur);
if(mines[i][j]==false
&& Math.floor(x)!=i
&&Math.floor(y)!=j){
    mines[cases.x][cases.y]=true;
    nbMines--;
}
}
return(mines);
};

var afficherTuiles=function(largeurCases,hauteurCases,largeur,hauteur){
    setScreenMode(largeur*largeurCases, hauteur*hauteurCases);
    for(var i=0;i<hauteur*hauteurCases;i+=hauteurCases){
        for(var j=0;j<largeur*largeurCases;j+=largeurCases){
            afficherImage(j,i,colormap,images[11]);
        }
    }
};
var compterMines=function(mines,x,y,largeur,hauteur){
var nbMinesAdj=0;
    for (var i=x-1;i<=x+1;i++){
        for(var j=y-1;j<=y+1;j++){
            if(i>=0&&i<=largeur&&j>=0&&j<=hauteur){
                if(mines[i][j]==true)
                nbMinesAdj+=1;
            }
        }
    }
    return(nbMinesAdj);
};
var devoilerCasesAdj=function(x,y,largeur,hauteur,mines,casesDevoile){
var nbMines;
    for (var i=x-1;i<=x+1;i++){
        for(var j=y-1;j<=y+1;j++){
            if(i>=0&&i<largeur&&j>=0&&j<hauteur){
                nbMines=compterMines(mines,i,j,largeur,hauteur);
                casesDevoile[i][j]=true;
                if(nbMines==0){
                afficherImage(i*16,j*16,colormap,images[0]);
                }else{
                 afficherImage(i*16,j*16,colormap,images[nbMines]);    
                }
            }
        }
    }
};
var creerCasesDevoile=function(hauteur,largeur){
    var casesDevoile= Array(largeur);
    
    for (var i=0;i<largeur;i++){
        casesDevoile[i]= Array(hauteur);
    }
    
    for(var i=0;i<=largeur-1;i++){
        for(var j=0;j<=hauteur-1;j++){
        casesDevoile[i][j]=false;
        }
    }
    return casesDevoile;
};
var verifierCasesDevoile= function(casesDevoile,nbMines,largeur,hauteur){
    var nbCasesDevoile=0;
    for(var i=0;i<largeur;i++){
        for (var j=0;j<hauteur;j++){
            if (casesDevoile[i][j]==true){
                nbCasesDevoile++;
            }
    
        }
    }
    if((largeur*hauteur)-nbMines==casesDevoile){
        return true;
    }else{
        return false;
    }
};
var devoilerMinesFin=function(mines,largeur,hauteur,x,y){
    for(var i=0;i<largeur;i++){
        for (var j=0;j<hauteur;j++){
            if (mines[i][j]==true&&i!=x&&j!=y){
                afficherImage(i*16,j*16,colormap,images[9]);    
            }
    
        }
    }
};

var demineur = function (largeur, hauteur, nbMines) {
var finPartie=false;
var partieGagnee=false;
var largCases=images[1].length;
var hautCases=images[1][1].length;
var nbMinesAdj;
var casesDevoile=creerCasesDevoile(hauteur,largeur);
afficherTuiles(largCases,hautCases,largeur,hauteur);
var souris = attendreClic();
afficherImage(souris[0]*largCases,souris[1]*hautCases,colormap,images[0]);
var mines=placerMines(largCases,hautCases,nbMines, souris[0], souris[1]);

while(finPartie==false){
    souris=attendreClic();
    if (mines[souris[0]][souris[1]]==false){
        nbMinesAdj=compterMines(mines,souris[0],souris[1],largeur,hauteur);
        if(nbMinesAdj!=0){
        afficherImage(souris[0]*largCases,souris[1]*hautCases,colormap,images[nbMinesAdj]);
        casesDevoile[souris[0]][souris[1]]=true;
        }else{devoilerCasesAdj(souris[0],souris[1],largeur,hauteur,mines,casesDevoile);
        }
    
    }else {
        afficherImage(souris[0]*largCases,souris[1]*hautCases,colormap,images[10]);
        finPartie=true;
        break;
    }
partieGagnee=verifierCasesDevoile(casesDevoile,nbMines,largeur,hauteur);
if(partieGagnee==true){break;}
}
devoilerMinesFin(mines,largeur,hauteur,souris[0],souris[1]);
};



var testDemineur = function () {};
